---
title: 数据写入
description: 使用 SQL 命令向 TDengine 写入数据
---

本文以[智能电表示例数据](../../get-started/package)为例，介绍如何使用 SQL 命令写入数据。使用 SQL 命令写入数据时，数据可以来自于 SQL 命令，CSV 文件或查询结果。

## 向子表写入数据

本节介绍如何向**子表**和**普通表**中写入数据，该语法不可以用于超级表。

### 从 SQL 命令中插入数据

直接在 INSERT INTO 命令中，指定插入普通表/子表的数据，每条 SQL 命令可以指定多个表，每个表可以插入多条数据：

```sql
INSERT INTO
    test.d1 VALUES ('2017-07-17 21:00:00.000', 2.12, 8, -0.865)
                   ('2017-07-17 22:00:00.000', 1.98, 8, -0.865)
    test.d2 VALUES ('2017-07-17 21:00:00.000', 0.78, 10, -0.865)
                   ('2017-07-17 22:00:00.000', 0.78, 10, -0.865);
```

其中 `test.d1`、`test.d2` 指定了被插入的表名和所在数据库（`test`）；`VALUE ...` 定义了被插入的数据；`VALUE` 后的每个括号，定义了一组被插入的数据值，括号中的数据必须与表的列结构匹配。

使用一条 SQL 语句批量地插入多条数据，效率高于使用多条 SQL 语句逐一插入。但需注意，一条 SQL 语句总长度不能超过 1MB。

### 从 CSV 文件中插入数据

指定 CSV 文件，将文件中的数据插入：

```sql
INSERT INTO test.d2 FILE data.csv;
```

其中，`./data.csv` 不包含表头，每行对应一条数据：

```text title='data.csv'
'2017-07-17 23:00:00', 0.78, 10, -0.865
'2017-07-18 00:00:00', 0.78, 10, -0.865
'2017-07-18 01:00:00', 0.78, 10, -0.865
'2017-07-18 02:00:00', 0.78, 10, -0.865
```

### 从查询结果中插入

可以将查询结果的数据，写入到表中，查询结果需要与被写入的表具有相同结构：

```sql
INSERT INTO test.d4 SELECT * FROM test.d2 WHERE ts >= '2017-07-17 21:00:00';
```

### 写入指定字段

上文在插入数据时，需要给定每一列的数据值。除此之外，还可以仅对指定的列进行插入，未指定的列自动填充空值 `null`：

```sql
INSERT INTO d3 (ts, current) VALUES (NOW(), 0.78);
```

其中的 `(ts, current)` 指定了需要被插入的列；时间戳主键不能为空值，必须被指定插入。

## 写入时自动建表

在某些特殊场景中，用户在写数据时并不确定某个数据采集点的表是否存在，此时可在写入数据时使用自动建表语法来创建不存在的表，若该表已存在则不会建立新表且后面的 USING 语句被忽略。比如：

```sql
INSERT INTO d1001 USING meters TAGS (2, "California.SanFrancisco") VALUES (NOW(), 10.2, 219, 0.32);
```

上述 SQL 语句将记录`(NOW(), 10.2, 219, 0.32)`插入表 `d1001`。如果表 `d1001` 还未创建，则使用超级表 meters 做模板自动创建，同时打上标签值 `"California.SanFrancisco", 2`。

在写入时自动建表，对写入性能有一定影响；如非必要，请先完成建表，再向表中写入数据，这样能够最大程度地提升写入性能。

## 重复时间戳主键

当被插入数据的时间戳主键与已存储数据的时间戳主键重复时，新插入的数据将会覆盖旧数据。在后续的数据查询中，只有新数据能够被读取；在下列例子中，经过两次重复时间戳的插入，查询结果只能得到一条数据。

```sql
INSERT INTO test.d1 VALUES ('2017-07-17 23:00:00.000', 1, 1, 0);
INSERT INTO test.d1 VALUES ('2017-07-17 23:00:00.000', 100, 100, 0);
SELECT * FROM test.d1 WHERE ts='2017-07-17 23:00:00.000';
```

被覆盖的数据并不会被马上删除，每次读取数据，都要从多条重复时间戳主键的数据中，寻找出最新插入的那一条，这一过程会耗费一定的计算资源。因此，多次插入带有相同时间戳主键的数据，会对查询性能造成负面影响，应该避免。

在超级表的查询中，可能存在重复的时间戳，这是因为超级表不储存数据，它的数据来自于多个子表。在每个子表中，重复时间戳相符覆盖。

## 其他写入方式

关于 SQL 写入命令的详细使用方式，例如对**超级表**进行写入，请参考[SQL 手册](../../taos-sql/insert)。

在实际使用中，TD engine 还需要从 SCADA 系统、消息队列等不同的数据源获取数据。TDengine 支持多种[数据写入方式](../../develop/insert-data)，这使 TDengine 够方便地集成到各种系统中。同时，TDengine 企业版和 TDengine 云服务，还支持 PI System、OPC-UA、OPC-DA、MQTT 等数据源，并能够以低代码的方式进行数据源管理。