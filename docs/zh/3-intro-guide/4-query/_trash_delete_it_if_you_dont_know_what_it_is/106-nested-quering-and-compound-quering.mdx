---
title: 嵌套与组合查询
description: 嵌套查询与组合查询
---

## 嵌套查询

如果把查询的结果看作一张表，就可以对这张表进行进一步查询，形成查询语句的嵌套：

```sql
-- 对查询结果进行查询
SELECT * FROM
    (SELECT _wend AS ts, MAX(voltage) AS vol1 FROM test.d1111 INTERVAL(1h));

-- 对查询结果进行 JOIN
SELECT q1.ts AS ts, vol1, vol2 FROM 
    (
        SELECT _wend AS ts, MAX(voltage) AS vol1 FROM test.d1111
        INTERVAL(1h)
    ) AS q1
    JOIN
    (
        SELECT _wend AS ts, MIN(voltage) AS vol2 FROM test.d112
        INTERVAL(1h)
    ) AS q2 
    ON q1.ts=q2.ts;
```

## UNION ALL

如果两个查询结果具有相同的列结构，可以使用 UNION ALL，将两个结果查询结果合并到一起（并集）：

```sql
SELECT FIRST(*) FROM test.d1031
UNION ALL
SELECT FIRST(*) FROM test.d1032;
/*
        first(ts)        |    first(current)    | first(voltage) |     first(phase)     |
=========================================================================================
 2017-07-14 02:40:00.000 |           -2.5980761 |             12 |           -0.8560250 |
 2017-07-14 02:40:00.000 |           -2.5980761 |             16 |           -0.8660250 |
*/


-- 单独执行时；

SELECT FIRST(*) FROM test.d1031;
/*
        first(ts)        |    first(current)    | first(voltage) |     first(phase)     |
=========================================================================================
 2017-07-14 02:40:00.000 |           -2.5980761 |             12 |           -0.8560250 |
*/
SELECT FIRST(*) FROM test.d1032;
/*
        first(ts)        |    first(current)    | first(voltage) |     first(phase)     |
=========================================================================================
 2017-07-14 02:40:00.000 |           -2.5980761 |             16 |           -0.8660250 |
*/
```